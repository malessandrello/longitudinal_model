---
title: "Longitudinal Data Analysis and Modeling"
author: "Mauricio Alessandrello"
format: 
  html:
    page-layout: full
    css: style.css
    toc: TRUE
    toc-location: left
    cap-location: bottom
title-block-banner: "#00524e"
title-block-banner-color: "white"

---

## Summary

The present document is a longitudinal data analysis and modeling report. The dataset used can be obtained from [here](https://e-m-mccormick.github.io/static/longitudinal-primer/07-datasets.html). This dataset contains the dorsolateral prefrontal cortex (DLPFC) activity measured when adolescents (ages 11.74 - 15.33) were subjected to an executive function task. Behavioral scores on that tasks are also included. The measurements were distributed in 4 annually waves. The variables of the dataset are subject identification ('id'), subject sex ('sex'), treatment group ('tx'), annual measures of DLPFC activity during task ('dlpfc'), behavioral score on that task ('ef') and age('age')  

## Exploratory data analysis 


```{r load_data, warning=FALSE, message=FALSE}


#Load used libraries
library(tidyverse)
library(readr)
library(lmerTest)
library(rstatix)


#Load data and transform to long format
executive_function <- read_csv("datasets/executive-function.csv")

# The variables (dlpfc, ef and age) were separated to transform the data in long format.
ex.func_dlpfc <- executive_function %>% 
  select(1:7) %>% 
  pivot_longer(cols = 4:7, names_to = "wave", values_to = "dlpfc") %>% 
  mutate(wave = case_when(wave == "dlpfc1" ~ as_factor(0),
                          wave == "dlpfc2" ~ as_factor(1),
                          wave == "dlpfc3" ~ as_factor(2),
                          wave == "dlpfc4" ~ as_factor(3)),
         id = as.factor(id))

ex.func_ef <- executive_function %>% 
  select(1:3, 8:11) %>% 
  pivot_longer(cols = 4:7, names_to = "wave", values_to = "ef") %>% 
  mutate(wave = case_when(wave == "ef1" ~ as_factor(0),
                          wave == "ef2" ~ as_factor(1),
                          wave == "ef3" ~ as_factor(2),
                          wave == "ef4" ~ as_factor(3)),
         id = as.factor(id))

ex.func_age <- executive_function %>% 
  select(1:3, 12:15) %>% 
  pivot_longer(cols = 4:7, names_to = "wave", values_to = "age") %>% 
  mutate(wave = case_when(wave == "age1" ~ as_factor(0),
                          wave == "age2" ~ as_factor(1),
                          wave == "age3" ~ as_factor(2),
                          wave == "age4" ~ as_factor(3)),
         id = as.factor(id))


# And then were put it all together in a single data frame.
data <- list(ex.func_dlpfc, ex.func_ef, ex.func_age)

full_data <- reduce(data, full_join)




#Summary statistics of the different variables

#Overall DLPFC activity
dlpfc_stats <- full_data %>% 
  group_by(wave) %>%
  get_summary_stats(dlpfc)

knitr::kable(dlpfc_stats, caption = "Statistics of DLPFC activity across waves")


#DLPFC activity by sex
dlpfc_stats_sex1 <- full_data %>% 
  group_by(wave) %>%
  filter(sex == 1) %>% 
  get_summary_stats(dlpfc)


knitr::kable(dlpfc_stats_sex1, caption = "Statistics of DLPFC activity for sex = 1 across waves")

dlpfc_stats_sex0 <- full_data %>% 
  group_by(wave) %>%
  filter(sex == 0) %>% 
  get_summary_stats(dlpfc)

knitr::kable(dlpfc_stats_sex0, caption = "Statistics of DLPFC activity for sex = 0 across waves")


```


